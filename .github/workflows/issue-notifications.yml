name: Project Card Notifications

on:
  project_card:
    types: [moved]

jobs:
  send_email:
    runs-on: ubuntu-latest
    steps:
      - name: Send email notification on project card move
        env:
          SMTP_SERVER: smtp.gmail.com
          SMTP_PORT: 465
          EMAIL_USERNAME: ${{ secrets.EMAIL_USERNAME }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        run: |
          set -x  # Habilitar el modo de depuración
          echo "A card has been moved in the project:"
          echo "Card ID: ${{ github.event.project_card.id }}"
          echo "Card Note: ${{ github.event.project_card.note }}"
          echo "Card URL: ${{ github.event.project_card.url }}"
          
          echo "Sending email notification..."
          response=$(curl -s --url "smtps://$SMTP_SERVER:$SMTP_PORT" --ssl-reqd \
            --mail-from "${EMAIL_USERNAME}" \
            --mail-rcpt "alejandragarcia1@upb.edu" \
            --user "${EMAIL_USERNAME}:${EMAIL_PASSWORD}" \
            --upload-file - <<END
          From: aleandy7@gmail.com
          To: alejandragarcia1@upb.edu
          Subject: Card Moved: ${{ github.event.project_card.note }}

          A card has been moved in the project:
          Card ID: ${{ github.event.project_card.id }}
          Card Note: ${{ github.event.project_card.note }}
          Card URL: ${{ github.event.project_card.url }}
          END
          )

          echo "Response from email server: $response"

          # Verifica el código de salida de curl
          if [ $? -ne 0 ]; then
            echo "Error: Failed to send email."
            exit 1
          fi
